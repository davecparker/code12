this = {}; _fn = {}   -- This file was generated by Code12 from "minesweeper.java"
package.path = package.path .. ';../../Desktop/Code12/?.lua;../../../Desktop/Code12/?.lua'
require('Code12.api')
    
    this.rows = 10
    this.columns = 10
    this.squares = { length = this.rows * this.columns, default = nil }
    this.numbMines = 10
    this.squareState = nil; 
    
    
        
        
    
    
    --Function to put the squares into a pseudo 2d array
    function _fn.setSquare(x, y, square)
        
        local i = (y * this.columns) + x
        ct.checkArrayIndex(this.squares, i); this.squares[1+(i)] = square
    end
    
    function _fn.getSquareIndex(square)
        
        local i = 0; while i < this.squares.length do
            
            if square == ct.indexArray(this.squares, i) then
                return i; end
        i = i + 1; end
        return -1
    end
    
    function _fn.setSquareValue(x, y, value)
        
        local i = (y * this.columns) + x
        local setMe = ct.indexArray(this.squares, i)
        setMe:setText(value)
    end
    
    function _fn.getSquareValue(x, y)
        
        local i = (y * this.columns) + x
        local getMe = ct.indexArray(this.squares, i)
        return getMe:getText()
    end
    
    function _fn.getSquare(x, y)
        
        local i = (y * this.columns) + x
        return ct.indexArray(this.squares, i)
        
    end
    
    function _fn.goodIndex(x, y)
        
        if x >= 0 and x < this.rows then
            
            if y >= 0 and y < this.columns then
                
                local i = (y * this.columns) + x
                if i >= 0 and i <= this.squares.length - 1 then
                    
                    return true
                end
            end
        end
        
        return false
    end
    
    function _fn.emptySquare(i)
        
        local x = i % this.columns
        local y = ct.intDiv(i, this.columns)
        
        local j = -1; while j <= 1 do
            
            local k = -1; while k <= 1 do
                
                if _fn.goodIndex(x + j, y + k) then
                    
                    local otherSquare = _fn.getSquare(x + j, y + k)
                    if otherSquare.visible then
                        
                        otherSquare.visible = false
                        local compare = otherSquare:getText()
                        if (compare == "0") then
                            
                            local otherSquareI = _fn.getSquareIndex(otherSquare)
                            _fn.emptySquare(otherSquareI)
                        end
                    end
                end
            k = k + 1; end
        j = j + 1; end
    end
    
    function _fn.onMouseRelease(obj, x, y)
        
        if obj ~= nil then
            
            obj.visible = false
            this.squareState = obj:getText()
            
            if (this.squareState == "Mine") then
                
                for _, square in ipairs(this.squares) do
                    
                    square.clickable = false
                    local compare = square:getText()
                    if (compare == "Mine") then
                        
                        if square.visible then
                            
                            square.visible = false
                        end
                    end
                end
                
                local endText = ct.text("Game Over", 50, 20, 20)
                endText:setLayer(3)
            end
            
            if (this.squareState == "0") then
                
                local i = _fn.getSquareIndex(obj)
                local sqrX = i % this.columns
                local sqrY = ct.intDiv(i, this.columns)
                local j = -1; while j <= 1 do
                    
                    local k = -1; while k <= 1 do
                        
                        if _fn.goodIndex(sqrX + j, sqrY + k) then
                            
                            local otherSquare = _fn.getSquare(sqrX + j, sqrY + k)
                            otherSquare.visible = false
                            local compare = otherSquare:getText()
                            if (compare == "0") then
                                
                                local otherSquareI = _fn.getSquareIndex(otherSquare)
                                _fn.emptySquare(otherSquareI)
                            end
                        end
                    k = k + 1; end
                j = j + 1; end
            end
        end
    end
    
    function _fn.start()
        
        local x = 0; while x < this.rows do
            
            local y = 0; while y < this.columns do
                
                local square = ct.rect(2.7 + (x * 5), 12.9 + (y * 5), 5, 5, "gray")
                square.clickable = true
                square:setLayer(2)
                square:setText("")
                _fn.setSquare(x, y, square)
            y = y + 1; end
        x = x + 1; end
        
        --Plants the mines
        local m = 0
        local mineCords = { length = this.numbMines, default = 0 }
        
        while m < this.numbMines do
            
            local randX = ct.random(0, this.rows - 1)
            local randY = ct.random(0, this.columns - 1)
            --Checks if there is already a mine at this randomly selected coordinate
            local uniqueMine = true
            local newMineCord = this.columns * randX + randY
            
            for _, mineChord in ipairs(mineCords) do
                
                if mineChord == newMineCord then
                    uniqueMine = false; end
            end
            
            if uniqueMine then
                
                _fn.setSquareValue(randX, randY, "Mine")
                ct.checkArrayIndex(mineCords, m); mineCords[1+(m)] = newMineCord
                m = m + 1
            end
        end
        
        --Calculates the square numbers
        local x = 0; while x < this.rows do
            
            local y = 0; while y < this.columns do
                
                
                this.squareState = _fn.getSquareValue(x, y)
                if not ((this.squareState == "Mine")) then
                    
                    local adjMines = 0
                    local j = -1; while j <= 1 do
                        
                        local k = -1; while k <= 1 do
                            
                            if _fn.goodIndex(x + j, y + k) then
                                
                                local compare = _fn.getSquareValue(x + j, y + k)
                                if (compare == "Mine") then
                                    
                                    adjMines = adjMines + (1)
                                end
                            end
                        k = k + 1; end
                    j = j + 1; end
                    if adjMines == 0 then
                        _fn.setSquareValue(x, y, "0"); 
                    else 
                        
                        _fn.setSquareValue(x, y, ct.formatInt(adjMines))
                    end
                end
            y = y + 1; end
        x = x + 1; end
        
        --Draws the square numbers and mines
        for _, square in ipairs(this.squares) do
            
            
            local sqrX = square.x
            local sqrY = square.y
            
            this.squareState = square:getText()
            if (this.squareState == "Mine") then
                
                ct.image("mine.jpg", sqrX, sqrY, 5)
            
            else 
                
                if (this.squareState == "0") then
                    
                    ct.text("", sqrX, sqrY, 5)
                
                else 
                    
                    ct.text(this.squareState, sqrX, sqrY, 5)
                end
                
            end
            
        end
    end
    
